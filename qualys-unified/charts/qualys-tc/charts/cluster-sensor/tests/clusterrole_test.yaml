suite: Test clusterrole creation
values:
  - ../values.yaml
templates:
  - clustersensor-clusterrole.yaml
tests:
  - it: Should pass all kinds of assertions for clusterrole
    set:
        global:
            openshift: true
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ClusterRole
      - equal:
          path: apiVersion
          value: "rbac.authorization.k8s.io/v1"
      - equal:
          path: metadata.name
          value: qualys-clustersensor-cluster-reader-role
      - equal:
          path: rules[0].apiGroups
          value: [""]
      - equal:
          path: rules[0].resources
          value: ["pods", "namespaces", "nodes", "services", "serviceaccounts"]
      - equal:
          path: rules[0].verbs
          value: ["watch"]
      - equal:
          path: rules[1].apiGroups
          value: [ "discovery.k8s.io" ]
      - equal:
          path: rules[1].resources
          value: [ "endpointslices" ]
      - equal:
          path: rules[1].verbs
          value: ["watch"]
      - equal:
          path: rules[2].apiGroups
          value: [ "networking.k8s.io" ]
      - equal:
          path: rules[2].resources
          value: [ "ingresses" ]
      - equal:
          path: rules[2].verbs
          value: [ "watch" ]
      - equal:
          path: rules[3].apiGroups
          value: [ "*" ]
      - equal:
          path: rules[3].resources
          value: [ "*" ]
      - equal:
          path: rules[3].verbs
          value: [ "get","list" ]
      - equal:
          path: rules[4].apiGroups
          value: [ "security.openshift.io" ]
      - equal:
          path: rules[4].resources
          value: [ "securitycontextconstraints" ]
      - equal:
          path: rules[4].verbs
          value: [ "create", "get", "list", "watch", "update", "patch", "delete" ]
